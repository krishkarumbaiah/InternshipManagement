<div class="container mt-4 attendance-wrapper">
  <h2 class="page-title">ğŸ“ Attendance Management</h2>

  <!-- Controls -->
  <div class="row mb-4 attendance-controls">
    <!-- Select Batch -->
    <div class="col-md-4">
      <label class="form-label fw-bold">Select Batch</label>
      <select
        class="form-select custom-select"
        [(ngModel)]="selectedBatch"
        (change)="loadUsers(selectedBatch)"
      >
        <option [ngValue]="null">-- Select Batch --</option>
        <option *ngFor="let b of batches" [value]="b.id">{{ b.name }}</option>
      </select>
    </div>

    <!-- Date Picker -->
    <div class="col-md-4">
      <label class="form-label fw-bold">Date</label>
      <input type="date" class="form-control custom-date" [(ngModel)]="date" />
    </div>
  </div>

  <!-- Mark Attendance Table -->
  <h5 *ngIf="users.length > 0" class="mt-3">âœ… Mark Attendance</h5>
  <table
    class="table table-striped table-bordered table-hover shadow-sm mt-2"
    *ngIf="users.length > 0"
  >
    <thead class="table-primary">
      <tr>
        <th>#</th>
        <th>Intern</th>
        <th>Present?</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let u of users; index as i">
        <td>{{ i + 1 }}</td>
        <td class="fw-bold">{{ u.userName }}</td>
        <td>
          <input type="checkbox" [(ngModel)]="attendance[u.userId]" class="form-check-input" />
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Save Button -->
  <button class="btn btn-save mt-3" (click)="markAttendance()" *ngIf="users.length > 0">
    <i class="pi pi-check-circle"></i> Save Attendance
  </button>

  <!-- Empty Message -->
  <p *ngIf="users.length === 0 && selectedBatch" class="text-muted mt-3 text-center">
    âŒ No interns found for this batch.
  </p>

  <!-- Attendance History -->
  <div *ngIf="history.length > 0" class="mt-5">
    <h5>ğŸ“Š Attendance History</h5>
    <table class="table table-bordered shadow-sm">
      <thead class="history-header">
        <tr>
          <th>#</th>
          <th>Intern</th>
          <th>Batch</th>
          <th>Status</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let h of history; index as i">
          <td>{{ i + 1 }}</td>
          <td>{{ h.userName }}</td>
          <td>{{ h.batchName }}</td>
          <td>
            <span class="badge" [ngClass]="h.isPresent ? 'bg-success' : 'bg-danger'">
              {{ h.isPresent ? 'Present' : 'Absent' }}
            </span>
          </td>
          <td>{{ h.date | date : 'mediumDate' }}</td>
          <td>
            <button class="btn btn-sm btn-danger" (click)="deleteHistory(h.id)">ğŸ—‘ï¸ Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Export Buttons -->
  <div class="d-flex justify-content-end gap-2 mb-3">
    <button class="btn btn-outline-success btn-sm" (click)="exportToExcel()">
      â¬‡ï¸ Export Excel
    </button>
    <button class="btn btn-outline-danger btn-sm" (click)="exportToPDF()">ğŸ“„ Export PDF</button>
  </div>

  <table class="table table-bordered shadow-sm">
    <thead>
      <tr>
        <th>#</th>
        <th>Intern</th>
        <th>Batch</th>
        <th>Status</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let h of history; index as i">
        <td>{{ i + 1 }}</td>
        <td>{{ h.userName }}</td>
        <td>{{ h.batchName }}</td>
        <td>
          <span class="badge" [ngClass]="h.isPresent ? 'bg-success' : 'bg-danger'">
            {{ h.isPresent ? 'Present' : 'Absent' }}
          </span>
        </td>
        <td>{{ h.date | date : 'mediumDate' }}</td>
      </tr>
    </tbody>
  </table>
</div>
