<div class="container mt-4 dashboard-wrapper">
  <!-- Welcome -->
  <div
    class="welcome-row d-flex flex-column flex-md-row align-items-center justify-content-between mb-3"
  >
    <div>
      <h2 class="dashboard-title fw-bold mb-0">Welcome, {{ username }} üëã</h2>
      <p class="dashboard-subtitle text-muted mb-0">
        Role: <span class="fw-semibold">{{ roles.join(', ') }}</span>
      </p>
    </div>

    <!-- small meta / timestamp or quick summary (non-functional placeholder) -->
    <div class="text-muted small mt-3 mt-md-0">
      <span class="me-3">Overview</span>
      <span *ngIf="overview" class="text-muted"
        >Users: <strong>{{ overview.users.total }}</strong></span
      >
    </div>
  </div>

  <hr class="section-divider" />

  <!-- ================= Admin Dashboard ================= -->
  <div *ngIf="isAdmin()" class="mt-3">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h3 class="section-title text-primary mb-0">üìä Admin Dashboard</h3>
    </div>

    <!-- Stat Cards -->
    <div *ngIf="overview; else adminLoading" class="row g-4 align-items-stretch">
      <!-- Users Card -->
      <div class="col-6 col-md-3">
        <div class="stat-card card-clean h-100">
          <div class="card-body d-flex flex-column align-items-start justify-content-between">
            <div class="d-flex align-items-center gap-3 w-100">
              <div class="icon-wrap blue">
                <i class="bi bi-people-fill"></i>
              </div>
              <div>
                <h6 class="mb-0">Users</h6>
                <div class="value">{{ overview.users.total }}</div>
              </div>
            </div>
            <div class="meta-line w-100">
              <span class="small text-muted">Total registered users</span>
              <span class="float-end small text-success">‚óè</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Batches Card -->
      <div class="col-6 col-md-3">
        <div class="stat-card card-clean h-100">
          <div class="card-body d-flex flex-column align-items-start justify-content-between">
            <div class="d-flex align-items-center gap-3 w-100">
              <div class="icon-wrap green">
                <i class="bi bi-diagram-3-fill"></i>
              </div>
              <div>
                <h6 class="mb-0">Batches</h6>
                <div class="value">{{ overview.batches }}</div>
              </div>
            </div>
            <div class="meta-line w-100">
              <span class="small text-muted">Active batches</span>
              <span class="float-end small text-muted"> </span>
            </div>
          </div>
        </div>
      </div>

      <!-- QnA Card -->
      <div class="col-6 col-md-3">
        <div class="stat-card card-clean h-100">
          <div class="card-body d-flex flex-column align-items-start justify-content-between">
            <div class="d-flex align-items-center gap-3 w-100">
              <div class="icon-wrap yellow">
                <i class="bi bi-question-circle-fill"></i>
              </div>
              <div>
                <h6 class="mb-0">Questions</h6>
                <div class="value">{{ overview.qnA.total }}</div>
              </div>
            </div>

            <!-- progress indicator for answered percentage -->
            <div class="w-100 mt-2">
              <div class="d-flex justify-content-between small text-muted mb-1">
                <span>Answered</span>
                <span>
                  {{
                    (overview.qnA.total
                      ? ((overview.qnA.total - overview.qnA.unanswered) / overview.qnA.total) * 100
                      : 0
                    ) | number : '1.0-0'
                  }}%
                </span>
              </div>
              <div class="progress sm">
                <div
                  class="progress-bar"
                  role="progressbar"
                  [style.width.%]="
                    overview.qnA.total
                      ? ((overview.qnA.total - overview.qnA.unanswered) / overview.qnA.total) * 100
                      : 0
                  "
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>
              <div class="meta-line w-100 mt-2">
                <small class="text-muted"
                  >Unanswered: <strong>{{ overview.qnA.unanswered }}</strong></small
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Attendance Card -->
      <div class="col-6 col-md-3">
        <div class="stat-card card-clean h-100">
          <div class="card-body d-flex flex-column align-items-start justify-content-between">
            <div class="d-flex align-items-center gap-3 w-100">
              <div class="icon-wrap red">
                <i class="bi bi-calendar-check-fill"></i>
              </div>
              <div>
                <h6 class="mb-0">Attendance</h6>
                <div class="value">{{ overview.attendance.presentRate | number : '1.0-2' }}%</div>
              </div>
            </div>
            <div class="meta-line w-100">
              <span class="small text-muted">Records: {{ overview.attendance.totalRecords }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- thin line separator -->
    <div class="section-line my-4"></div>

    <!-- Charts Row -->
    <div class="row g-4 align-items-stretch">
      <!-- Attendance Overview (donut) -->
      <div class="col-12 col-md-6">
        <div class="card chart-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">üìà Attendance Overview</h6>
              <small class="text-muted">Percent present / absent</small>
            </div>
            <div class="chart-canvas-wrapper">
              <canvas baseChart [data]="adminAttendanceChart" [type]="'doughnut'"></canvas>
            </div>
            <div class="chart-legend mt-3 text-muted small">
              <span class="me-3">‚óè Present</span>
              <span class="me-3">‚óè Absent</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Per Batch (bar) -->
      <div class="col-12 col-md-6">
        <div class="card chart-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">üë• Users Per Batch</h6>
              <small class="text-muted">Distribution across batches</small>
            </div>
            <div class="chart-canvas-wrapper">
              <canvas baseChart [data]="adminUsersChart" [type]="'bar'"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #adminLoading>
      <p class="text-muted text-center mt-4">‚è≥ Loading admin dashboard data...</p>
    </ng-template>
  </div>

  <hr class="section-divider my-5" />

  <!-- ================= Intern Dashboard ================= -->
  <div *ngIf="isIntern()" class="mt-2">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h3 class="section-title text-success mb-0">üéì Intern Dashboard</h3>
    </div>

    <!-- üîπ Intern Stat Cards -->
    <div *ngIf="myOverview" class="row g-4 align-items-stretch mb-4">
      <!-- My Attendance -->
      <div class="col-6 col-md-3">
        <div class="stat-card card-clean h-100">
          <div class="card-body d-flex flex-column align-items-start justify-content-between">
            <div class="d-flex align-items-center gap-3 w-100">
              <div class="icon-wrap blue">
                <i class="bi bi-calendar-check"></i>
              </div>
              <div>
                <h6 class="mb-0">My Attendance</h6>
                <div class="value">
                  {{
                    (myOverview.attendance.presentDays / myOverview.attendance.totalDays) * 100
                      | number : '1.0-0'
                  }}%
                </div>
              </div>
            </div>
            <div class="meta-line w-100">
              <span class="small text-muted"
                >{{ myOverview.attendance.presentDays }}/{{
                  myOverview.attendance.totalDays
                }}
                days</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- My Questions -->
      <div class="col-6 col-md-3">
        <div class="stat-card card-clean h-100">
          <div class="card-body d-flex flex-column align-items-start justify-content-between">
            <div class="d-flex align-items-center gap-3 w-100">
              <div class="icon-wrap yellow">
                <i class="bi bi-question-circle"></i>
              </div>
              <div>
                <h6 class="mb-0">My Questions</h6>
                <div class="value">{{ myOverview.questions.total }}</div>
              </div>
            </div>
            <div class="meta-line w-100">
              <span class="small text-muted">Total asked by you</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Answered -->
      <div class="col-6 col-md-3">
        <div class="stat-card card-clean h-100">
          <div class="card-body d-flex flex-column align-items-start justify-content-between">
            <div class="d-flex align-items-center gap-3 w-100">
              <div class="icon-wrap green">
                <i class="bi bi-check-circle-fill"></i>
              </div>
              <div>
                <h6 class="mb-0">Answered</h6>
                <div class="value">{{ myOverview.questions.answered }}</div>
              </div>
            </div>
            <div class="meta-line w-100">
              <span class="small text-muted">Responses received</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Unanswered -->
      <div class="col-6 col-md-3">
        <div class="stat-card card-clean h-100">
          <div class="card-body d-flex flex-column align-items-start justify-content-between">
            <div class="d-flex align-items-center gap-3 w-100">
              <div class="icon-wrap red">
                <i class="bi bi-x-circle-fill"></i>
              </div>
              <div>
                <h6 class="mb-0">Unanswered</h6>
                <div class="value">{{ myOverview.questions.unanswered }}</div>
              </div>
            </div>
            <div class="meta-line w-100">
              <span class="small text-muted">Pending answers</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Intern Charts -->
    <div *ngIf="myOverview; else internLoading" class="row g-4">
      <!-- Attendance Chart -->
      <div class="col-12 col-md-6">
        <div class="card chart-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">üìÖ Attendance</h6>
              <small class="text-muted">Your attendance summary</small>
            </div>
            <div class="chart-canvas-wrapper">
              <canvas baseChart [data]="internAttendanceChart" [type]="'doughnut'"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- QnA Chart -->
      <div class="col-12 col-md-6">
        <div class="card chart-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">üí¨ QnA</h6>
              <small class="text-muted">Your questions/answers</small>
            </div>
            <div class="chart-canvas-wrapper">
              <canvas baseChart [data]="internQnaChart" [type]="'bar'"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #internLoading>
      <p class="text-muted text-center mt-4">‚è≥ Loading intern dashboard data...</p>
    </ng-template>
  </div>
</div>
